# 签赋 LabelShop 页眉页脚（页码）功能说明

版本：6.21.1867  &emsp; 2021-12-29 

<h2 id="contents">目录</h2>

1. [概述](#summary)
2. [格式定义](#format)
3. [项目定义](#itemfmt)
4. [模板内容定义](#template)
5. [使用SDK](#sdk)

<h2 id="summary">1. 概述</h2>

签赋 LabelShop 可以自定义多种格式的页眉页脚，可以同时使用多个页眉页脚项目。这些项目包括文字、条码、二维码以及直线、仅矩形、圆等。

文字和条码项目的内容可以自行定义，包括固定的文字、从模板文档中获取到的页码、一些变量数据以及连接的数据库的字段值等，并可以进行一些简单的数据格式化功能。

目前页码中支持以下内容：
* [文本](#text)
* [条码、二维码](#barcode)
* [直线](#line)
* [图形（仅矩形、圆）](#sharp)

<h2 id="format">2. 格式定义</h2>

![示意图](https://www.labelfor.cn/images/help/ht01.png)

* **输出页眉页脚**：是否在打印页面输出页眉页脚

* **页眉页脚样式**：每个样式的名称

    * **导入**：从配置文件导入页眉页脚设置
    * **导出**：将当前页眉页脚设置导出到文件
    * **新建**：新增一个页眉页脚项目
    * **移除**：移除当前页眉页脚项目（默认项目不可以移除）

> 页眉页脚项目的位置定义，基于以下原则：
> 1. 以纸张`纵向`为正方向，上面为`顶部`，下面为`底部`，`左侧`和`右侧`亦以此方向来定义
> 2. `偏移`和`距离`的参考点，可以是纸张的边界或者打印内容的外框，通过`纸边定位`进行设置
> 3. 对于默认的打印内容定位方式，`距离`是指项目到打印内容的距离，`偏移`为文字左右或者上下位置的调整
> 4. 对于`顶部`和`底部`，文字默认方向为向上，对于`左侧`和`右侧`，文字默认方向为向右，可以通过`旋转180度`来改变方向
> 5. `对齐`是指项目在偏移方向的的停靠方式，`左齐`、`右齐`或者`居中`，此处的参考点同样依赖于定位方式。不同的停靠方式，偏移的参考点是不一样的。

* **参数设置**：设置当前页眉页脚项目的参数
    * **位置**：项目所处的位置，以页面纵向为正方向
    * **对齐**：项目的停靠方式
    * **偏移**：对项目的`左右`（顶部底部）或者`上下`（左侧右侧）位置进行调整
    * **距离**：项目相对于定位参考边界的距离
    * **设置字体**：设置文本项目的字体
    * **纸边定位**：调整`定位方式`，
    * **旋转180度**：文本或者条码项目旋转180度
    * **文字样式**：显示当前项目的文本项目
    * **模板**：项目定义，描述项目的具体信息

<h2 id="itemfmt">3. 项目定义</h2>

`模板`用于描述项目的具体属性。

模板中涉及到的位置尺寸等，是单位为 1/100mm 的整数，例如 12mm 需要表示为 1200, 100 表示 1mm

<h3 id="line">3.1 直线</h3>

以`&L`开始的模板内容，被定义为直线项目

> 例如：`&L1200,#FF0000`， 其中`,`（半角逗号）为项目分隔符。直线的宽度默认为输出设备 1 个物理点的宽度，如果需要其它宽度的直线，请使用`图形`实现。

以上示例中：

* `&L` ：必选，表示这是一个直线项目
* `1200` ：必选，表示直线长度为 12 mm，此处要求为一整数数值，单位是 1/100 mm
* `#FF0000` ：可选，RGB方式描述的直线的颜色，默认为黑色

<h3 id="sharp">3.2 图形</h3>

以`&R`开始的模板内容，被定义为图形项目

> 例如：`&R1200,500,R,#FF0000`， 其中`,`（半角逗号）为项目分隔符，
或者：`&R1200,500` 、 `&R1200,E` 、 `&R1200,500,#FFFF00` 、 `&R1200,500,R200` 等样式

以上示例中：

* `&R` ：必选，表示这是一个图形项目
* `1200` ：必选，表示图形长度为 12 mm，此处要求为一整数数值，单位是 1/100 mm
* `500` ：可选，图形的宽度，单位是 1/100 mm，默认为和长度相等
* `R`或者`E` ：可选，圆角矩形或者圆。`R` 圆角矩形，或者 `R200` 样式，表示矩形圆角 2mm。 `E` 椭圆或者圆。当长度宽度相等时，为正方形或者正圆形。
* `#FF0000` ：可选，RGB方式描述的直线的颜色，默认为黑色

<h3 id="barcode">3.3 条码和二维码</h3>

以`&B`开始的模板内容，被定义为条码、二维码项目

> 形如：`&Ba,n,h,c,f,t`， 其中`,`（半角逗号）为项目分隔符

以上格式中：

* `&B` ：必选，表示这是一个条码、二维码项目
* `a` ：必选，条码类型，目前支持 `39`、`128`、`QR`、`DM`
* `n` ：必选，条码的X尺寸，数值为LabelShop中的条码X尺寸的数值 * 100，例如 10.00 mil， 数值为 1000
* `h` ：必选，表示一维码的高度，整数数值，单位是 1/100 mm，例如码高 5mm，数值为 500 
* `c` ：必选，RGB方式描述的直线的颜色，形如#FF0000，可为空，默认为黑色
* `f` ：必选，可为空。格式描述，对于 QR 码，可以使用 `E0` 到 `E3` 分别方式表示 `QR` 码的`纠错等级 L、M、Q、H`。
* `t` ：必选，用于格式化页眉页脚内容的模板串，详见[模板内容定义](#template)。

<h3 id="text">3.4 文本</h3>

除了以上三种项目以外的其它项目，都被定义为文本项目

> 形如：`c,t`， 其中`,`（半角逗号）为项目分隔符

* `c` ：可选，RGB方式描述的直线的颜色，形如#FF0000，可为空，默认为黑色
* `t` ：必选，用于格式化页眉页脚内容的模板串，详见[模板内容定义](#template)。

<h2 id="template">4. 模板内容定义</h2>

模板内容定义，用于定义生成数据内容的样式。内容定义为一个字符串，其中 `&` 字符为转义字符，和它后面的一个字符共同定义一个数据项目。

> 形如：`&F &T` 、 `&P / &A` 等。

紧跟`&`字符后面的字符定义如下：

* `&` ：使用`&`字符
* `F` ：模板文件标题，一般是移除文件路径和文件扩展名后的文件名
* `D` ：样式为 `2021-12-02` 的当前日期
* `T` ：样式为 `14:05:23` 的当前时间
* `H` ：模板文件的文件名，包含文件路径和扩展名
* `C` ：当前页内总计的标签数量
* `A` ：总计页数
* `P` ：当前页页码
* `S` ：当前页第一个标签的标签序号
* `E` ：当前页最后一个标签的标签序号
* `K` ：数据库的标题，一般是移除文件路径和文件扩展名后的数据文件名
* `M` ：当前页第一个标签的数据序号
* `N` ：当前页最后一个标签的数据序号
* `U` ：数据库记录总数
* `I` ：数据库文件的文件名，包含文件路径和扩展名
* `[` ：如后面一个`]`字符配合，定义一个高级格式化项目，高级格式化项目允许通过提取标签中的一个变量的内容，生成更丰富的信息。`此功能暂时不建议使用。`

> 高级格式化形如以下格式: `[a-b/t(-f)p]`

* `a` ：必选，一个共享变量的变量名
* `b/t` ：可选，定义此项目仅出现在 每 t 页中的第 b 页上
* `(-f)` ：可选，`f` 为 形如 `????`的串，表示仅截取变量中的特定数量的字符，? 的数量表示截取字符的数量。`-`可选，表示从右侧截取。
* `p` ：必选，可以是 `S`、`E`或者一个数字，表示从模板上第几个标签上获取变量。`S` 表示第一个标签，`E` 表示 最后一个标签，数字表示具体的标签序号。

> 高级格式化示例
>* `[SN-S]` ：表示每页中第一个标签上的一个共享名为`SN`的变量的值

<h2 id="sdk">5. 使用SDK</h2>

> **请注意：** 当使用 `TLXLabelPaint` 库进行打印时，默认情况下是不输出 页眉页脚和对位裁切标记的。如果需要输出这些内容，请先使用 `TLXSetSystemSettings` 接口做相应的配置。

按口定义如下：

```cpp
/*
TLXSetSystemSettings
功能：设置参数
参数：
	name		参数项目
	value	参数值
返回值：
	0	成功
	16	不支持的设置项目
说明：
此接口用于设置各类系统参数值
*/
int AFX_API_EXPORT WINAPI TLXSetSystemSettings(const char* name, const char* value);
```

其中：

name 可取值为：
* `position_cutting_mark` ：  设置裁切标记
* `header_footer`  ： 设置页眉页脚

value 可取值为：
* `default` ：使用 签赋 LabelShop 的默认设置
* `none` ： 不输出
* 一个有效的文件名 ：从一个配置文件导入配置
* 一个JSON字符串 ：从JSON导入配置


```cpp
	switch (parkpmset)
	{
	case 0:	//	使用LabelShop的默认设置
		TLXSetSystemSettings("position_cutting_mark", "default");	//	定位裁切标记
		TLXSetSystemSettings("header_footer", "default");		//	页眉页脚
		break;
	case 1:	//	不输出
		TLXSetSystemSettings("position_cutting_mark", "none");	//	定位裁切标记
		TLXSetSystemSettings("header_footer", "none");	//	页眉页脚
		break;
	case 2:	//	 通过文件导入设置
		TLXSetSystemSettings("position_cutting_mark", "d:\\temp\\定位标记.lcpj");	//	定位裁切标记
		TLXSetSystemSettings("header_footer", "d:\\temp\\测试导出页眉设置.hfpj");	//	页眉页脚
		break;
	case 3:	//	通过json数据导入设置
	{
		std::string strmarks;
		readFromFile("d:\\temp\\定位标记.lcpj", strmarks);	//	将文件读入到 std::string 中
		TLXSetSystemSettings("position_cutting_mark", strmarks.c_str());	//	定位裁切标记

		std::string strpagenumber;
		readFromFile("d:\\temp\\测试导出页眉设置.hfpj", strpagenumber);	//	将文件读入到 std::string 中
		TLXSetSystemSettings("header_footer", strpagenumber.c_str());	//	页眉页脚
	}
		break;
	}
```

